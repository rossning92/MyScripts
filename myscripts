#!/bin/bash
set -e
cd "$(dirname "$0")"

# Check if Debian-based Linux distro
if [[ "$(uname)" == "Linux" ]] && [[ -f "/etc/debian_version" ]]; then
    # Install required packages
    declare -a packages=(
        "python3"
        "python3-pip"
        # "sxhkd"
        # "wmctrl"
    )
    for package in "${packages[@]}"; do
        dpkg -s "$package" >/dev/null 2>&1 || {
            sudo apt-get update
            sudo apt-get install -y "$package"
        }
    done

    # Start sxhkd
    # touch ~/.sxhkdrc
    # killall sxhkd >/dev/null 2>&1 || true
    # setsid sxhkd -c ~/.sxhkdrc >/dev/null 2>&1 &

    # Disable capslock key
    # setxkbmap -option ctrl:nocaps

elif command -v termux-setup-storage; then # is running in termux
    if [[ ! -x "$(command -v python)" ]]; then
        pkg update
        pkg install -y python
    fi
fi

# Autostart on any Linux desktop
# mkdir -p ~/.config/autostart/
# cat >~/.config/autostart/myscripts.desktop <<EOF
# [Desktop Entry]
# Type=Application
# Name=MyScripts
# Exec=alacritty -e $HOME/MyScripts/myscripts --startup
# StartupNotify=false
# Terminal=false
# EOF

# Bash alias
line="export PATH=\"$(pwd)/bin:\$PATH\""
BASHRC="$HOME/.bashrc"
# Append a line to $BASHRC file if it doesn't already exist.
if [ ! -f "$BASHRC" ] || ! grep -qF -- "$line" "$BASHRC"; then
    echo "$line" >>"$BASHRC"
fi

# Set terminal title
echo -ne '\033]0;MyTerminal\007'

# Default settings for FZF
export FZF_DEFAULT_OPTS='--layout=reverse'

[[ ! -d "$HOME/.venv/myscripts" ]] && python3 -m venv "$HOME/.venv/myscripts" --system-site-packages
source "$HOME/.venv/myscripts/bin/activate"

pip install -r requirements.txt >/dev/null
python myscripts.py "$@"
